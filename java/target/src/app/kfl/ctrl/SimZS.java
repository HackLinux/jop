/*
 * SimZS.java
 *
 * Created on 05. Februar 2002, 15:52
 */
import PnlStation;
import Station;
/**
 *
 * @author  Standard
 */
public class SimZS extends javax.swing.JFrame {

	private List st = Station.find();
	private PnlStation[] ps;
	/** Creates new form SimZS */
	public SimZS() {
		initComponents();
		ps = new PnlStation[st.size()];
		int cnt = 0;
		for (Iterator i = st.iterator(); i.hasNext(); ) {
			Station s = (Station) i.next();
			int ver = s.version();
			PnlStation p = new PnlStation(s.nr(), ver);
			pnlDetail.add(p);
			ps[cnt++] = p;
			txtResult.append("Station "+s.nr()+" version "+(ver>>6)+"."+(ver&0x3f)+"\n");
		}
		pack();			// again
        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        java.awt.Dimension dialogSize = getSize();
        setLocation((screenSize.width-dialogSize.width)/2,(screenSize.height-dialogSize.height)/2);

		startThread();
	}

	private void startThread() {

	new Thread() {

		public void run() {
			while(true) {
				try {
					sleep(100);
				} catch (InterruptedException e) {}

				if (chkUpdate.isSelected()) {

					int idx = 0;
					final int[][] data = new int[st.size()][7];

					for (Iterator i = st.iterator(); i.hasNext(); ) {
						Station s = (Station) i.next();
						data[idx][0] = s.inp();
						data[idx][1] = s.opto();
						data[idx][2] = s.cnt();
						data[idx][3] = s.stat();
						data[idx][4] = s.iadc(0);
						data[idx][5] = s.iadc(1);
						data[idx][6] = s.iadc(2);
						++idx;
					}

					Runnable r = new Runnable() {
						public void run() {

							int min = 0;
							int max = 0;
							for (int idx=0; idx<st.size(); ++idx) {
								PnlStation p = ps[idx];
								p.setInp(data[idx][0]);
								p.setOpto(data[idx][1]);
								int imp = data[idx][2];
								p.setImpuls(imp);
								p.setStatus(data[idx][3]);
								p.setStrom(data[idx][4], data[idx][5], data[idx][6]);
								if (idx==0) {
									min = max = imp;
								} else {
									if (imp<min) min = imp;
									if (imp>max) max = imp;
								}
							}
							txtDiff.setText(""+(max-min));
		  				}
					};
					SwingUtilities.invokeLater(r);
				}
			}
		}
	}.start();

	}

	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
    private void initComponents() {//GEN-BEGIN:initComponents
        pnlMain = new javax.swing.JPanel();
        pnlStationen = new javax.swing.JPanel();
        pnlDetail = new javax.swing.JPanel();
        pnlDiff = new javax.swing.JPanel();
        jLabel5 = new javax.swing.JLabel();
        txtDiff = new javax.swing.JTextField();
        chkUpdate = new javax.swing.JCheckBox();
        pnlMainButton = new javax.swing.JPanel();
        btnUp = new javax.swing.JButton();
        btnDown = new javax.swing.JButton();
        btnStop = new javax.swing.JButton();
        pnlButton = new javax.swing.JPanel();
        btnInfo = new javax.swing.JButton();
        btnResCnt = new javax.swing.JButton();
        btnResTim = new javax.swing.JButton();
        btnReset = new javax.swing.JButton();
        pnlCmd = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        txtAddr = new javax.swing.JTextField();
        txtCmd = new javax.swing.JTextField();
        txtData = new javax.swing.JTextField();
        btnExec = new javax.swing.JButton();
        pnlResult = new javax.swing.JPanel();
        scrResult = new javax.swing.JScrollPane();
        txtResult = new javax.swing.JTextArea();
        btnResultClear = new javax.swing.JButton();
        
        setTitle("Simulate ZS");
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                exitForm(evt);
            }
        });
        
        pnlMain.setLayout(new java.awt.GridBagLayout());
        java.awt.GridBagConstraints gridBagConstraints1;
        
        pnlMain.setBorder(new javax.swing.border.EmptyBorder(new java.awt.Insets(10, 10, 10, 10)));
        pnlStationen.setLayout(new java.awt.GridBagLayout());
        java.awt.GridBagConstraints gridBagConstraints2;
        
        pnlStationen.setBorder(new javax.swing.border.EtchedBorder());
        gridBagConstraints2 = new java.awt.GridBagConstraints();
        gridBagConstraints2.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints2.insets = new java.awt.Insets(5, 5, 5, 5);
        gridBagConstraints2.weighty = 1.0;
        pnlStationen.add(pnlDetail, gridBagConstraints2);
        
        pnlDiff.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 20, 0));
        
        jLabel5.setText("max. Differenz:");
        pnlDiff.add(jLabel5);
        
        txtDiff.setEditable(false);
        txtDiff.setColumns(5);
        pnlDiff.add(txtDiff);
        
        chkUpdate.setText("autom. Aktualisieren");
        pnlDiff.add(chkUpdate);
        
        gridBagConstraints2 = new java.awt.GridBagConstraints();
        gridBagConstraints2.gridx = 0;
        gridBagConstraints2.gridy = 1;
        gridBagConstraints2.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints2.insets = new java.awt.Insets(5, 5, 5, 5);
        pnlStationen.add(pnlDiff, gridBagConstraints2);
        
        gridBagConstraints1 = new java.awt.GridBagConstraints();
        gridBagConstraints1.gridwidth = 2;
        gridBagConstraints1.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints1.insets = new java.awt.Insets(5, 5, 5, 5);
        gridBagConstraints1.anchor = java.awt.GridBagConstraints.WEST;
        pnlMain.add(pnlStationen, gridBagConstraints1);
        
        pnlMainButton.setLayout(new java.awt.GridBagLayout());
        java.awt.GridBagConstraints gridBagConstraints3;
        
        pnlMainButton.setBorder(new javax.swing.border.EtchedBorder());
        btnUp.setText("Hinauf");
        btnUp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnUpActionPerformed(evt);
            }
        });
        
        gridBagConstraints3 = new java.awt.GridBagConstraints();
        gridBagConstraints3.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints3.insets = new java.awt.Insets(5, 5, 5, 5);
        gridBagConstraints3.weightx = 0.5;
        pnlMainButton.add(btnUp, gridBagConstraints3);
        
        btnDown.setText("Herunter");
        btnDown.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDownActionPerformed(evt);
            }
        });
        
        gridBagConstraints3 = new java.awt.GridBagConstraints();
        gridBagConstraints3.gridx = 1;
        gridBagConstraints3.gridy = 0;
        gridBagConstraints3.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints3.insets = new java.awt.Insets(5, 5, 5, 5);
        gridBagConstraints3.weightx = 0.5;
        pnlMainButton.add(btnDown, gridBagConstraints3);
        
        btnStop.setText("Stop");
        btnStop.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnStopActionPerformed(evt);
            }
        });
        
        gridBagConstraints3 = new java.awt.GridBagConstraints();
        gridBagConstraints3.gridx = 0;
        gridBagConstraints3.gridy = 1;
        gridBagConstraints3.gridwidth = 2;
        gridBagConstraints3.gridheight = 2;
        gridBagConstraints3.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints3.insets = new java.awt.Insets(5, 5, 5, 5);
        gridBagConstraints3.weightx = 0.5;
        gridBagConstraints3.weighty = 1.0;
        pnlMainButton.add(btnStop, gridBagConstraints3);
        
        gridBagConstraints1 = new java.awt.GridBagConstraints();
        gridBagConstraints1.gridx = 0;
        gridBagConstraints1.gridy = 1;
        gridBagConstraints1.gridwidth = 2;
        gridBagConstraints1.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints1.insets = new java.awt.Insets(5, 5, 5, 5);
        gridBagConstraints1.anchor = java.awt.GridBagConstraints.WEST;
        pnlMain.add(pnlMainButton, gridBagConstraints1);
        
        pnlButton.setLayout(new java.awt.GridLayout(0, 2, 5, 5));
        
        pnlButton.setBorder(new javax.swing.border.EtchedBorder());
        btnInfo.setText("Info");
        btnInfo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnInfoActionPerformed(evt);
            }
        });
        
        pnlButton.add(btnInfo);
        
        btnResCnt.setText("res. Cnt");
        btnResCnt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnResCntActionPerformed(evt);
            }
        });
        
        pnlButton.add(btnResCnt);
        
        btnResTim.setText("res. Time");
        btnResTim.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnResTimActionPerformed(evt);
            }
        });
        
        pnlButton.add(btnResTim);
        
        btnReset.setText("Reset");
        btnReset.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnResetActionPerformed(evt);
            }
        });
        
        pnlButton.add(btnReset);
        
        gridBagConstraints1 = new java.awt.GridBagConstraints();
        gridBagConstraints1.gridx = 0;
        gridBagConstraints1.gridy = 2;
        gridBagConstraints1.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints1.insets = new java.awt.Insets(5, 5, 5, 5);
        gridBagConstraints1.anchor = java.awt.GridBagConstraints.WEST;
        pnlMain.add(pnlButton, gridBagConstraints1);
        
        pnlCmd.setLayout(new java.awt.GridBagLayout());
        java.awt.GridBagConstraints gridBagConstraints4;
        
        pnlCmd.setBorder(new javax.swing.border.EtchedBorder());
        jLabel1.setText("Address:");
        gridBagConstraints4 = new java.awt.GridBagConstraints();
        gridBagConstraints4.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints4.insets = new java.awt.Insets(5, 5, 5, 5);
        pnlCmd.add(jLabel1, gridBagConstraints4);
        
        jLabel2.setText("Command:");
        gridBagConstraints4 = new java.awt.GridBagConstraints();
        gridBagConstraints4.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints4.insets = new java.awt.Insets(5, 5, 5, 5);
        pnlCmd.add(jLabel2, gridBagConstraints4);
        
        jLabel3.setText("Data:");
        gridBagConstraints4 = new java.awt.GridBagConstraints();
        gridBagConstraints4.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints4.insets = new java.awt.Insets(5, 5, 5, 5);
        pnlCmd.add(jLabel3, gridBagConstraints4);
        
        gridBagConstraints4 = new java.awt.GridBagConstraints();
        gridBagConstraints4.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints4.insets = new java.awt.Insets(5, 5, 5, 5);
        pnlCmd.add(jLabel4, gridBagConstraints4);
        
        txtAddr.setText("1");
        gridBagConstraints4 = new java.awt.GridBagConstraints();
        gridBagConstraints4.gridx = 0;
        gridBagConstraints4.gridy = 1;
        gridBagConstraints4.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints4.insets = new java.awt.Insets(5, 5, 5, 5);
        pnlCmd.add(txtAddr, gridBagConstraints4);
        
        txtCmd.setText("1");
        gridBagConstraints4 = new java.awt.GridBagConstraints();
        gridBagConstraints4.gridx = 1;
        gridBagConstraints4.gridy = 1;
        gridBagConstraints4.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints4.insets = new java.awt.Insets(5, 5, 5, 5);
        pnlCmd.add(txtCmd, gridBagConstraints4);
        
        txtData.setText("0");
        gridBagConstraints4 = new java.awt.GridBagConstraints();
        gridBagConstraints4.gridx = 2;
        gridBagConstraints4.gridy = 1;
        gridBagConstraints4.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints4.insets = new java.awt.Insets(5, 5, 5, 5);
        pnlCmd.add(txtData, gridBagConstraints4);
        
        btnExec.setText("Exec");
        btnExec.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnExecActionPerformed(evt);
            }
        });
        
        gridBagConstraints4 = new java.awt.GridBagConstraints();
        gridBagConstraints4.gridx = 3;
        gridBagConstraints4.gridy = 1;
        gridBagConstraints4.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints4.insets = new java.awt.Insets(5, 5, 5, 5);
        pnlCmd.add(btnExec, gridBagConstraints4);
        
        gridBagConstraints1 = new java.awt.GridBagConstraints();
        gridBagConstraints1.gridx = 1;
        gridBagConstraints1.gridy = 2;
        gridBagConstraints1.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints1.insets = new java.awt.Insets(5, 5, 5, 5);
        gridBagConstraints1.anchor = java.awt.GridBagConstraints.WEST;
        pnlMain.add(pnlCmd, gridBagConstraints1);
        
        pnlResult.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));
        
        pnlResult.setBorder(new javax.swing.border.EtchedBorder());
        txtResult.setColumns(40);
        txtResult.setRows(10);
        scrResult.setViewportView(txtResult);
        
        pnlResult.add(scrResult);
        
        btnResultClear.setText("cls");
        btnResultClear.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnResultClearActionPerformed(evt);
            }
        });
        
        pnlResult.add(btnResultClear);
        
        gridBagConstraints1 = new java.awt.GridBagConstraints();
        gridBagConstraints1.gridx = 0;
        gridBagConstraints1.gridy = 3;
        gridBagConstraints1.gridwidth = 2;
        gridBagConstraints1.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints1.insets = new java.awt.Insets(5, 5, 5, 5);
        gridBagConstraints1.anchor = java.awt.GridBagConstraints.WEST;
        pnlMain.add(pnlResult, gridBagConstraints1);
        
        getContentPane().add(pnlMain, java.awt.BorderLayout.CENTER);
        
        pack();
        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        java.awt.Dimension dialogSize = getSize();
        setLocation((screenSize.width-dialogSize.width)/2,(screenSize.height-dialogSize.height)/2);
    }//GEN-END:initComponents

        private void btnResetActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnResetActionPerformed
			txtResult.append(Station.reset());
        }//GEN-LAST:event_btnResetActionPerformed

        private void btnResTimActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnResTimActionPerformed
			txtResult.append(Station.resTime());
        }//GEN-LAST:event_btnResTimActionPerformed

        private void btnResCntActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnResCntActionPerformed
			txtResult.append(Station.resCnt());
        }//GEN-LAST:event_btnResCntActionPerformed

		private void btnInfoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnInfoActionPerformed
			txtResult.append(Station.info());
		}//GEN-LAST:event_btnInfoActionPerformed

		private void btnStopActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnStopActionPerformed
			txtResult.append(Station.stop());
		}//GEN-LAST:event_btnStopActionPerformed

		private void btnDownActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDownActionPerformed
			txtResult.append(Station.down());
		}//GEN-LAST:event_btnDownActionPerformed

		private void btnUpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnUpActionPerformed
			txtResult.append(Station.up());
		}//GEN-LAST:event_btnUpActionPerformed

	private void btnExecActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnExecActionPerformed
		// Add your handling code here:
		int i = Station.getMsg().exchg(Integer.parseInt(txtAddr.getText()), Integer.parseInt(txtCmd.getText()),
					Integer.parseInt(txtData.getText()));
		if (i<0) {
			txtResult.append("Fehler "+i+"\n");
		} else {
			txtResult.append(""+i+"\n");
		}
	}//GEN-LAST:event_btnExecActionPerformed

	private void btnResultClearActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnResultClearActionPerformed
		txtResult.setText("");
	}//GEN-LAST:event_btnResultClearActionPerformed

	/** Exit the Application */
	private void exitForm(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_exitForm
		System.exit(0);
	}//GEN-LAST:event_exitForm

	/**
	* @param args the command line arguments
	*/
	public static void main(String args[]) {
		new SimZS().show();
	}


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel pnlMain;
    private javax.swing.JPanel pnlStationen;
    private javax.swing.JPanel pnlDetail;
    private javax.swing.JPanel pnlDiff;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JTextField txtDiff;
    private javax.swing.JCheckBox chkUpdate;
    private javax.swing.JPanel pnlMainButton;
    private javax.swing.JButton btnUp;
    private javax.swing.JButton btnDown;
    private javax.swing.JButton btnStop;
    private javax.swing.JPanel pnlButton;
    private javax.swing.JButton btnInfo;
    private javax.swing.JButton btnResCnt;
    private javax.swing.JButton btnResTim;
    private javax.swing.JButton btnReset;
    private javax.swing.JPanel pnlCmd;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JTextField txtAddr;
    private javax.swing.JTextField txtCmd;
    private javax.swing.JTextField txtData;
    private javax.swing.JButton btnExec;
    private javax.swing.JPanel pnlResult;
    private javax.swing.JScrollPane scrResult;
    private javax.swing.JTextArea txtResult;
    private javax.swing.JButton btnResultClear;
    // End of variables declaration//GEN-END:variables

}
