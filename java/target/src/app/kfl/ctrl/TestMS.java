/*
 * TestMS.java
 *
 * Created on 09. Jänner 2002, 13:45
 */

/**
 *
 * @author  Standard
 */
import BBSys;
import Find;
import Msg;
import SetAddress;

public class TestMS extends javax.swing.JFrame {

	private Msg m = new Msg();
	private JCheckBox chk[];
	private String[] label = {
		"L1 Spannung",
		"L2 Spannung",
		"L3 Spannung",
		"L1 Strom",
		"L2 Strom",
		"L3 Strom",
		"N Strom",
		"Taster ab",
		"Taster auf",
		"Not Stop",
		"Tür",
		"Sensor Impuls",
		"Sensor oben",
		"Sensor unten",
		"Motor läuft",
		"hinunter"
	};

	/** Creates new form TestMS */
	public TestMS() {
		initComponents();
		chk = new JCheckBox[label.length];
		for (int i=0; i<label.length; ++i) {
			chk[i] = new JCheckBox(label[i]);
			chk[i].disable();
			pnlTop.add(chk[i]);
		}
		new Thread() {
			public void run() {
			while(true) {
				try {
					sleep(100);
				} catch (InterruptedException e) {}
				if (chkStatus.isSelected()) {

					String res = "";
					int v1 = m.exchg(Integer.parseInt(txtAddr.getText()), BBSys.CMD_STATUS, 0);
					if (v1<0) {
						m.clear();
						res = "Status Fehler "+v1;
					}
					int v2 = m.exchg(Integer.parseInt(txtAddr.getText()), BBSys.CMD_INP, 0);
					if (v2<0) {
						m.clear();
						res = "Inp Fehler "+v2;
					}
					int v3 = m.exchg(Integer.parseInt(txtAddr.getText()), BBSys.CMD_OPTO, 0);
					if (v3<0) {
						m.clear();
						res = "Opto Fehler "+v3;
					}
					int v4 = m.exchg(Integer.parseInt(txtAddr.getText()), BBSys.CMD_CNT, 0);
					if (v4<0) {
						m.clear();
						res = "Cnt Fehler "+v4;
					}
			
					int val = v2 | (v1<<7);
					val <<= 7;
					val |= v3;
			
					final String txt = res;
					final int fval = val;
										final int cnt = v4;
					Runnable r = new Runnable() {
						public void run() {
							String s = "";
							if (txt.length()!=0) {
								txtResult.setText(txt);
							}
							int val = fval;
							for (int i=0; i<16; ++i) {
								if (i<chk.length) chk[i].setSelected((val&0x01)==1);
								if ((val&0x01)==1) {
									s += "1";
								} else {
									s += "0";
								}
								val >>>= 1;
							}
														txtCnt.setText(""+((cnt<<20)>>20));
		  				}
//	  txtStatus.setText(s);
					};
					SwingUtilities.invokeLater(r);
				}
			}
			}
		}.start();

	}

	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
		private void initComponents() {//GEN-BEGIN:initComponents
			jMenuBar1 = new javax.swing.JMenuBar();
			jMenu1 = new javax.swing.JMenu();
			mnuFind = new javax.swing.JMenuItem();
			mnuSetAddress = new javax.swing.JMenuItem();
			txtResult = new javax.swing.JTextField();
			pnlCenter = new javax.swing.JPanel();
			pnlInfo = new javax.swing.JPanel();
			jLabel1 = new javax.swing.JLabel();
			txtCnt = new javax.swing.JTextField();
			chkStatus = new javax.swing.JCheckBox();
			pnlButton = new javax.swing.JPanel();
			btnUp = new javax.swing.JButton();
			btnDown = new javax.swing.JButton();
			btnStop = new javax.swing.JButton();
			btnTime = new javax.swing.JButton();
			btnResImp = new javax.swing.JButton();
			btnResTim = new javax.swing.JButton();
			pnlCmd = new javax.swing.JPanel();
			jLabel2 = new javax.swing.JLabel();
			txtAddr = new javax.swing.JTextField();
			jLabel3 = new javax.swing.JLabel();
			txtCmd = new javax.swing.JTextField();
			jLabel4 = new javax.swing.JLabel();
			txtData = new javax.swing.JTextField();
			btnExec = new javax.swing.JButton();
			pnlTop = new javax.swing.JPanel();
			
			jMenu1.setText("Init");
			jMenu1.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					jMenu1ActionPerformed(evt);
				}
			});
			
			mnuFind.setText("Find");
			mnuFind.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					mnuFindActionPerformed(evt);
				}
			});
			
			jMenu1.add(mnuFind);
			mnuSetAddress.setText("new Address");
			mnuSetAddress.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					mnuSetAddressActionPerformed(evt);
				}
			});
			
			jMenu1.add(mnuSetAddress);
			jMenuBar1.add(jMenu1);
			
			getContentPane().setLayout(new java.awt.BorderLayout(10, 10));
			
			setTitle("Test f\u00fcr Maststation");
			addWindowListener(new java.awt.event.WindowAdapter() {
				public void windowClosing(java.awt.event.WindowEvent evt) {
					exitForm(evt);
				}
			});
			
			txtResult.setColumns(20);
			txtResult.setHorizontalAlignment(javax.swing.JTextField.LEFT);
			getContentPane().add(txtResult, java.awt.BorderLayout.SOUTH);
			
			pnlCenter.setLayout(new java.awt.BorderLayout(10, 10));
			
			pnlInfo.setLayout(new java.awt.GridLayout(0, 3, 10, 10));
			
			jLabel1.setText("Impulse");
			pnlInfo.add(jLabel1);
			
			txtCnt.setColumns(5);
			pnlInfo.add(txtCnt);
			
			chkStatus.setText("Status update");
			chkStatus.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					chkStatusActionPerformed(evt);
				}
			});
			
			pnlInfo.add(chkStatus);
			
			pnlCenter.add(pnlInfo, java.awt.BorderLayout.NORTH);
			
			pnlButton.setLayout(new java.awt.GridLayout(0, 2, 10, 10));
			
			btnUp.setText("Rauf");
			btnUp.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					btnUpActionPerformed(evt);
				}
			});
			
			pnlButton.add(btnUp);
			
			btnDown.setText("Runter");
			btnDown.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					btnDownActionPerformed(evt);
				}
			});
			
			pnlButton.add(btnDown);
			
			btnStop.setText("Stop");
			btnStop.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					btnStopActionPerformed(evt);
				}
			});
			
			pnlButton.add(btnStop);
			
			btnTime.setText("Time");
			btnTime.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					btnTimeActionPerformed(evt);
				}
			});
			
			pnlButton.add(btnTime);
			
			btnResImp.setText("Reset Imp.");
			btnResImp.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					btnResImpActionPerformed(evt);
				}
			});
			
			pnlButton.add(btnResImp);
			
			btnResTim.setText("Reset Time");
			btnResTim.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					btnResTimActionPerformed(evt);
				}
			});
			
			pnlButton.add(btnResTim);
			
			pnlCenter.add(pnlButton, java.awt.BorderLayout.CENTER);
			
			pnlCmd.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 10, 5));
			
			jLabel2.setText("Address:");
			pnlCmd.add(jLabel2);
			
			txtAddr.setColumns(2);
			txtAddr.setText("1");
			txtAddr.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
			pnlCmd.add(txtAddr);
			
			jLabel3.setText("Cmd:");
			pnlCmd.add(jLabel3);
			
			txtCmd.setColumns(3);
			txtCmd.setText("1");
			txtCmd.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
			pnlCmd.add(txtCmd);
			
			jLabel4.setText("Data:");
			pnlCmd.add(jLabel4);
			
			txtData.setColumns(3);
			txtData.setText("0");
			txtData.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
			pnlCmd.add(txtData);
			
			btnExec.setText("Exec");
			btnExec.addActionListener(new java.awt.event.ActionListener() {
				public void actionPerformed(java.awt.event.ActionEvent evt) {
					btnExecActionPerformed(evt);
				}
			});
			
			pnlCmd.add(btnExec);
			
			pnlCenter.add(pnlCmd, java.awt.BorderLayout.SOUTH);
			
			getContentPane().add(pnlCenter, java.awt.BorderLayout.CENTER);
			
			pnlTop.setLayout(new java.awt.GridLayout(0, 2));
			
			getContentPane().add(pnlTop, java.awt.BorderLayout.NORTH);
			
			setJMenuBar(jMenuBar1);
			pack();
			java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
			setSize(new java.awt.Dimension(400, 500));
			setLocation((screenSize.width-400)/2,(screenSize.height-500)/2);
		}//GEN-END:initComponents

		private void jMenu1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenu1ActionPerformed
			// Add your handling code here:
		}//GEN-LAST:event_jMenu1ActionPerformed

		private void mnuSetAddressActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuSetAddressActionPerformed
			// Add your handling code here:
			new SetAddress(m, Integer.parseInt(txtAddr.getText())).show();
		}//GEN-LAST:event_mnuSetAddressActionPerformed

		private void mnuFindActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mnuFindActionPerformed
			// Add your handling code here:
			new Find(m).show();
		}//GEN-LAST:event_mnuFindActionPerformed

		private void btnExecActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnExecActionPerformed
			// Add your handling code here:
		int i = m.exchg(Integer.parseInt(txtAddr.getText()), Integer.parseInt(txtCmd.getText()),
					Integer.parseInt(txtData.getText()));
		if (i<0) {
			m.clear();
			txtResult.setText("Fehler "+i);
		} else {
			txtResult.setText(""+i);
		}
		}//GEN-LAST:event_btnExecActionPerformed

		private void chkStatusActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_chkStatusActionPerformed
			// Add your handling code here:
		}//GEN-LAST:event_chkStatusActionPerformed

		private void btnResTimActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnResTimActionPerformed
			// Add your handling code here:
			cmd(BBSys.CMD_RESTIM);
		}//GEN-LAST:event_btnResTimActionPerformed

		private void btnResImpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnResImpActionPerformed
			// Add your handling code here:
			cmd(BBSys.CMD_SETCNT);
		}//GEN-LAST:event_btnResImpActionPerformed
	private void cmd(int val) {
		int i = m.exchg(Integer.parseInt(txtAddr.getText()), val, 0);
		if (i<0) {
			m.clear();
			txtResult.setText("Fehler "+i);
		} else {
			txtResult.setText(""+i);
		}
	}
	private void btnDownActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDownActionPerformed
		// Add your handling code here:
		cmd(BBSys.CMD_DOWN);
	}//GEN-LAST:event_btnDownActionPerformed

	private void btnUpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnUpActionPerformed
		// Add your handling code here:
		cmd(BBSys.CMD_UP);
	}//GEN-LAST:event_btnUpActionPerformed

	private void btnStopActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnStopActionPerformed
		// Add your handling code here:
		cmd(BBSys.CMD_STOP);
	}//GEN-LAST:event_btnStopActionPerformed

	private void btnTimeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimeActionPerformed
		// Add your handling code here:
		int i = m.exchg(Integer.parseInt(txtAddr.getText()), BBSys.CMD_TIME, 0);
		if (i<0) {
			m.clear();
			txtResult.setText("Fehler "+i);
		} else {
			txtResult.setText((i/29)+"."+((i-i/29*29)*10/29)+" ms");
		}

	}//GEN-LAST:event_btnTimeActionPerformed

	/** Exit the Application */
	private void exitForm(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_exitForm
		System.exit(0);
	}//GEN-LAST:event_exitForm

	/**
	* @param args the command line arguments
	*/
	public static void main(String args[]) {
		new TestMS().show();
	}


		// Variables declaration - do not modify//GEN-BEGIN:variables
		private javax.swing.JMenuBar jMenuBar1;
		private javax.swing.JMenu jMenu1;
		private javax.swing.JMenuItem mnuFind;
		private javax.swing.JMenuItem mnuSetAddress;
		private javax.swing.JTextField txtResult;
		private javax.swing.JPanel pnlCenter;
		private javax.swing.JPanel pnlInfo;
		private javax.swing.JLabel jLabel1;
		private javax.swing.JTextField txtCnt;
		private javax.swing.JCheckBox chkStatus;
		private javax.swing.JPanel pnlButton;
		private javax.swing.JButton btnUp;
		private javax.swing.JButton btnDown;
		private javax.swing.JButton btnStop;
		private javax.swing.JButton btnTime;
		private javax.swing.JButton btnResImp;
		private javax.swing.JButton btnResTim;
		private javax.swing.JPanel pnlCmd;
		private javax.swing.JLabel jLabel2;
		private javax.swing.JTextField txtAddr;
		private javax.swing.JLabel jLabel3;
		private javax.swing.JTextField txtCmd;
		private javax.swing.JLabel jLabel4;
		private javax.swing.JTextField txtData;
		private javax.swing.JButton btnExec;
		private javax.swing.JPanel pnlTop;
		// End of variables declaration//GEN-END:variables

}
